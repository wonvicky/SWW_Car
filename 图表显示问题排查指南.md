# 图表显示问题排查指南

## 问题描述
在另一台电脑上打开系统时，收入趋势图和订单分布图没有显示。

## 可能的原因

### 1. 网络连接问题（最常见）
**症状：** 图表区域显示为空白或显示警告信息
**原因：** Chart.js库依赖CDN加载，如果网络无法访问CDN，图表将无法显示

**解决方案：**
- ✅ **已修复**：系统现在使用多个CDN备选方案（国内CDN bootcdn + 国际CDN jsdelivr）
- 如果仍无法显示，请检查：
  1. 打开浏览器控制台（F12），查看Network标签，确认Chart.js是否加载成功
  2. 检查是否有网络防火墙或代理阻止CDN访问
  3. 尝试访问 https://cdn.bootcdn.net 确认网络连通性

### 2. 浏览器缓存问题
**症状：** 代码更新后图表仍不显示
**解决方案：**
```
1. 按 Ctrl + F5 强制刷新页面（清除缓存）
2. 或者按 Ctrl + Shift + Delete 清除浏览器缓存
3. 重新访问页面
```

### 3. 数据库数据为空
**症状：** 图表显示但没有数据点
**原因：** 数据库中没有订单数据或收入数据

**解决方案：**
```bash
# 进入项目目录
cd code/car_rental_system

# 检查数据库中是否有数据
python manage.py shell

# 在Python Shell中执行
from rentals.models import Rental
print(f"订单总数: {Rental.objects.count()}")
print(f"已完成订单: {Rental.objects.filter(status='COMPLETED').count()}")
```

### 4. JavaScript错误
**症状：** 浏览器控制台有错误信息
**解决方案：**
1. 按F12打开开发者工具
2. 切换到Console标签
3. 查看是否有红色错误信息
4. 根据错误信息进行排查

### 5. 数据库文件不存在
**症状：** 整个系统无法正常运行
**原因：** db.sqlite3文件没有复制到新电脑

**解决方案：**
```bash
# 如果数据库不存在，需要重新创建
python manage.py migrate

# 创建超级用户
python manage.py createsuperuser

# 需要重新添加数据
```

## 快速诊断步骤

### 步骤1：检查网络连接
```
打开浏览器访问：
https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js

如果能下载文件，说明网络正常
如果无法访问，说明是网络问题
```

### 步骤2：检查浏览器控制台
```
1. 访问仪表盘页面
2. 按F12打开开发者工具
3. 查看Console标签是否有错误
4. 查看Network标签，确认Chart.js是否加载（状态应为200）
```

### 步骤3：检查数据
```
访问 http://127.0.0.1:8000/admin/
登录后查看：
- Rentals（租赁订单）表是否有数据
- 是否有已完成的订单（COMPLETED状态）
```

## 最新优化

系统已更新以下改进：

1. **多CDN备选方案**
   - 优先使用国内CDN（bootcdn.net）
   - 失败时自动切换到国际CDN（jsdelivr.net）

2. **错误提示**
   - 如果Chart.js加载失败，会显示友好的错误提示
   - 提示用户检查网络连接或刷新页面

3. **延迟加载**
   - 等待页面完全加载后再初始化图表
   - 避免因加载顺序导致的问题

4. **异常处理**
   - 增加try-catch错误捕获
   - 在控制台输出详细错误信息便于调试

## 测试验证

更新后请按以下步骤验证：

```bash
# 1. 启动服务器
cd code/car_rental_system
python manage.py runserver

# 2. 访问仪表盘
# 打开浏览器访问：http://127.0.0.1:8000/

# 3. 检查图表
# - 收入趋势图应该在仪表盘上方显示
# - 订单状态分布图应该在收入趋势图右侧显示
# - 如果没有数据，图表会显示空白（这是正常的）
# - 如果无法加载，会显示警告信息
```

## 常见问题FAQ

**Q: 图表区域显示空白，但没有错误提示**
A: 可能是数据为空，检查数据库中是否有已完成的订单

**Q: 显示"图表加载失败"警告**
A: 网络无法访问CDN，检查网络连接或使用本地Chart.js库

**Q: 只有一个图表显示，另一个不显示**
A: 检查浏览器控制台，可能是某个图表初始化失败

**Q: 两台电脑数据不一致**
A: db.sqlite3数据库文件是本地的，需要复制或重新生成数据

## 联系支持

如果以上方法都无法解决问题，请：
1. 截图浏览器控制台的错误信息
2. 截图Network标签显示的资源加载情况
3. 说明具体的操作步骤和环境信息
