{% extends "base_user.html" %}
{% load static %}

{% block title %}浏览车辆 - 租车管理系统{% endblock %}

{% block content %}
<style>
/* 精选车辆徽章 */
.recommendation-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #fff5e6 0%, #ffe9cc 100%);
    border: 1px solid #ffd699;
    padding: 0.6rem 1.1rem;
    border-radius: 999px;
    font-size: 0.9rem;
    font-weight: 600;
    color: #d48a34;
    box-shadow: 0 2px 8px rgba(212, 138, 52, 0.15);
}

.recommendation-badge i {
    font-size: 1rem;
}

/* 筛选强调标签 */
.filter-accent {
    background: linear-gradient(135deg, rgba(212, 138, 52, 0.12) 0%, rgba(212, 138, 52, 0.08) 100%);
    border: 1px solid rgba(212, 138, 52, 0.25);
    color: #c47a2e;
    padding: 0.5rem 1rem;
    border-radius: 999px;
    font-size: 0.88rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-accent i {
    font-size: 0.95rem;
}
</style>
<div class="layout-stack">
    <section class="hero-section">
        <div class="hero-copy position-relative">
            <div class="recommendation-badge mb-3 text-dark">
                <i class="fas fa-car me-2"></i>学生优选
            </div>
            <h1>周末结伴出发，自驾游说走就走</h1>
            <p>专为下沙校区师生打造的租车平台，覆盖周边景点、露营地、特色小镇等热门目的地。3-5人组队更划算，车辆选择灵活，押金门槛低，支持异地还车，让你的周末出行自由又省心。</p>
            <ul class="list-unstyled hero-points mb-3">
                <li><i class="fas fa-check-circle"></i>车辆定期保养，安全出行有保障</li>
                <li><i class="fas fa-check-circle"></i>随时在线客服，行程变更灵活调整</li>
                <li><i class="fas fa-check-circle"></i>押金自动退还，费用清晰透明无套路</li>
            </ul>
            <div class="hero-actions">
                <a href="{% url 'accounts:order_create' %}" class="btn btn-accent">
                    <i class="fas fa-calendar-check me-2"></i>立即租车
                </a>
                <a href="{% url 'accounts:my_orders' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-receipt me-2"></i>我的订单
                </a>
            </div>
        </div>
        <div class="hero-panel">
            <div class="d-flex align-center justify-between">
                <h6 class="mb-0 text-muted">运营概览</h6>
                <span class="filter-accent"><i class="fas fa-sync-alt"></i>实时刷新</span>
            </div>
            <div class="hero-meta">
                <div class="hero-meta-card">
                    <span class="hero-meta-label">可用车辆</span>
                    <span class="hero-meta-value">{{ vehicle_stats.total }}</span>
                </div>
                <div class="hero-meta-card">
                    <span class="hero-meta-label">平均日租金</span>
                    <span class="hero-meta-value">¥{{ vehicle_stats.avg_rate|floatformat:0 }}</span>
                </div>
                <div class="hero-meta-card">
                    <span class="hero-meta-label">座位配置</span>
                    <span class="hero-meta-value">{{ vehicle_stats.seat_options }}</span>
                </div>
            </div>
            <div class="divider"></div>
            <div class="d-flex flex-wrap gap-2">
                <span class="tag-pill"><i class="far fa-clock me-1"></i>快速取车</span>
                <span class="tag-pill"><i class="far fa-shield-alt me-1"></i>在线客服</span>
                <span class="tag-pill"><i class="far fa-map me-1"></i>异地还车</span>
            </div>
        </div>
    </section>

    <section class="section section--light">
        <div class="section-header">
            <div>
                <div class="section-title"><i class="fas fa-chart-line me-2 text-primary"></i>车型一览</div>
                <p class="section-description">实时查看可用车型、价格区间和热门配置，快速找到适合你和小伙伴的车</p>
            </div>
            {% if popular_types %}
            <div class="d-flex flex-wrap gap-2 justify-content-end">
                {% for type in popular_types %}
                    <span class="tag-pill"><i class="fas fa-check-circle text-success"></i>{{ type }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div class="grid-3">
            <div class="surface surface--soft">
                <span class="label text-muted text-uppercase">可用车辆</span>
                <h3 class="mb-1 text-primary">{{ vehicle_stats.total }}</h3>
                <p class="mb-0 text-muted">车况良好、随订随用</p>
            </div>
            <div class="surface surface--soft">
                <span class="label text-muted text-uppercase">平均日租金</span>
                <h3 class="mb-1 text-primary">¥{{ vehicle_stats.avg_rate|floatformat:0 }}</h3>
                <p class="mb-0 text-muted">学生友好价，组队更划算</p>
            </div>
            <div class="surface surface--soft">
                <span class="label text-muted text-uppercase">座位配置</span>
                <h3 class="mb-1 text-primary">{{ vehicle_stats.seat_options }}</h3>
                <p class="mb-0 text-muted">2-7座车型，满足不同组队需求</p>
            </div>
        </div>
    </section>

    {% if recommended_vehicles %}
    <section class="section">
        <div class="section-header">
            <div>
                <div class="section-title"><i class="fas fa-star text-warning me-2"></i>猜你喜欢</div>
                <p class="section-description">根据你的租车记录和热门车型，推荐更适合你的选择</p>
            </div>
            <a href="{% url 'accounts:my_orders' %}" class="btn btn-outline-secondary"><i class="fas fa-clock me-2"></i>我的历史订单</a>
        </div>
        <div class="vehicle-grid">
            {% for vehicle in recommended_vehicles %}
            <div>
                <div class="vehicle-card-pro recommended h-100">
                    <div class="vehicle-card-header">
                        <div>
                            <div class="vehicle-title">{{ vehicle.brand }} {{ vehicle.model }}</div>
                            <span class="tag-pill"><i class="fas fa-tag"></i>{{ vehicle.vehicle_type }}</span>
                        </div>
                        <div class="vehicle-price-badge">
                            <div class="price-amount">¥{{ vehicle.daily_rate|floatformat:0 }}</div>
                            <div class="price-unit">/天</div>
                        </div>
                    </div>
                    <ul class="mb-3">
                        <li><i class="fas fa-id-card"></i>{{ vehicle.license_plate }}</li>
                        <li><i class="fas fa-chair"></i>{{ vehicle.seats }} 座</li>
                        <li><i class="fas fa-palette"></i>{{ vehicle.color|default:"经典色" }}</li>
                    </ul>
                    <div class="vehicle-meta-line">
                        <span><i class="far fa-clock me-1"></i>快速取车</span>
                        <span><i class="far fa-shield-alt me-1"></i>定期保养</span>
                    </div>
                    <div class="vehicle-card-action">
                        <a href="{% url 'accounts:vehicle_detail' vehicle.pk %}" class="btn btn-primary">
                            <i class="fas fa-eye me-2"></i>查看详情
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <section class="section business-filters">
        <div class="section-header border-0 mb-3 pb-0">
            <div>
                <div class="section-title"><i class="fas fa-filter text-primary me-2"></i>找车很简单</div>
                <p class="section-description">输入车牌、品牌或选择座位数，快速找到心仪车辆</p>
            </div>
            <span class="filter-accent"><i class="fas fa-magic"></i>多条件筛选 · 一键直达</span>
        </div>
        <form method="get" action="{% url 'accounts:home' %}" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">搜索车辆</label>
                <input type="text" name="q" class="form-control" placeholder="车牌号、品牌、型号..." value="{{ search_query }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">品牌</label>
                <select name="brand" class="form-select">
                    <option value="">全部品牌</option>
                    {% for brand in brands %}
                        <option value="{{ brand }}" {% if brand_filter == brand %}selected{% endif %}>
                            {{ brand }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">类型</label>
                <select name="type" class="form-select">
                    <option value="">全部类型</option>
                    {% for type in types %}
                        <option value="{{ type }}" {% if type_filter == type %}selected{% endif %}>
                            {{ type }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">座位数</label>
                <select name="seats" class="form-select">
                    <option value="">全部座位数</option>
                    {% for seats in seats_options %}
                        <option value="{{ seats }}" {% if seats_filter == seats|stringformat:"s" %}selected{% endif %}>
                            {{ seats }} 座
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-1"></i>搜索
                </button>
            </div>
        </form>
    </section>

    {% if vehicles %}
    <section class="section">
        <div class="section-header">
            <div>
                <div class="section-title"><i class="fas fa-car-side text-primary me-2"></i>所有可租车辆</div>
                <p class="section-description">涵盖经济型轿车、SUV、MPV 等多种车型，无论是双人出行还是多人组队，都能找到合适的车</p>
            </div>
            <div class="text-muted">共 {{ vehicles.paginator.count }} 辆可预约</div>
        </div>
        <div class="vehicle-grid">
            {% for vehicle in vehicles %}
            <div>
                <div class="vehicle-card-pro h-100">
                    <div class="vehicle-card-header">
                        <div>
                            <div class="vehicle-title">{{ vehicle.brand }} {{ vehicle.model }}</div>
                            <span class="tag-pill"><i class="fas fa-tag"></i>{{ vehicle.vehicle_type }}</span>
                        </div>
                        <div class="vehicle-price-badge">
                            <div class="price-amount">¥{{ vehicle.daily_rate|floatformat:0 }}</div>
                            <div class="price-unit">/天</div>
                        </div>
                    </div>
                    <ul class="mb-3">
                        <li><i class="fas fa-id-card"></i>{{ vehicle.license_plate }}</li>
                        <li><i class="fas fa-chair"></i>{{ vehicle.seats }} 座</li>
                        <li><i class="fas fa-fill-drip"></i>{{ vehicle.color }}</li>
                    </ul>
                    <div class="vehicle-meta-line">
                        <span><i class="far fa-clock me-1"></i>随订随用</span>
                        <span><i class="far fa-user-shield me-1"></i>贴心服务</span>
                    </div>
                    <div class="vehicle-card-action">
                        <a href="{% url 'accounts:vehicle_detail' vehicle.pk %}" class="btn btn-outline-secondary">
                            <i class="fas fa-eye me-2"></i>查看详情
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if vehicles.has_other_pages %}
        <nav aria-label="车辆分页" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if vehicles.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ vehicles.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if brand_filter %}&brand={{ brand_filter }}{% endif %}{% if type_filter %}&type={{ type_filter }}{% endif %}{% if seats_filter %}&seats={{ seats_filter }}{% endif %}">
                            上一页
                        </a>
                    </li>
                {% endif %}
                {% for num in vehicles.paginator.page_range %}
                    {% if vehicles.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% elif num > vehicles.number|add:'-3' and num < vehicles.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if brand_filter %}&brand={{ brand_filter }}{% endif %}{% if type_filter %}&type={{ type_filter }}{% endif %}{% if seats_filter %}&seats={{ seats_filter }}{% endif %}">
                                {{ num }}
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
                {% if vehicles.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ vehicles.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if brand_filter %}&brand={{ brand_filter }}{% endif %}{% if type_filter %}&type={{ type_filter }}{% endif %}{% if seats_filter %}&seats={{ seats_filter }}{% endif %}">
                            下一页
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </section>
    {% else %}
    <section class="section text-center">
        <i class="fas fa-car fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">暂无可用车辆</h4>
        <p class="text-muted">请稍后再来查看或联系客服</p>
    </section>
    {% endif %}
</div>
{% endblock %}


