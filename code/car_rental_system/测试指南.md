# 用户功能测试指南

## 一、准备工作

### 1. 安装依赖
```powershell
cd E:\新建文件夹\jyymvp\zuche\zuche\code\car_rental_system
.\.venv\Scripts\activate
pip install -r requirements.txt
```

### 2. 运行数据库迁移
```powershell
# 创建迁移文件
python manage.py makemigrations accounts
python manage.py makemigrations customers

# 应用迁移
python manage.py migrate

# 检查系统
python manage.py check
```

### 3. 启动服务器
```powershell
python manage.py runserver
```

## 二、功能测试步骤

### 功能模块1：用户认证（4个功能）

#### 1.1 用户注册
- **URL**: `http://127.0.0.1:8000/accounts/register/`
- **测试步骤**:
  1. 访问注册页面
  2. 输入用户名（至少3个字符）
  3. 输入邮箱（唯一）
  4. 输入密码（至少8个字符）
  5. 确认密码
  6. 点击注册按钮
- **预期结果**: 
  - 注册成功，跳转到登录页面
  - 显示成功消息
  - 数据库中创建新用户和用户资料

#### 1.2 用户登录
- **URL**: `http://127.0.0.1:8000/accounts/login/`
- **测试步骤**:
  1. 访问登录页面
  2. 输入用户名和密码
  3. 可选择"记住我"
  4. 点击登录按钮
- **预期结果**:
  - 登录成功，跳转到个人中心
  - 显示欢迎消息
  - 如果是管理员，跳转到管理后台

#### 1.3 用户登出
- **URL**: `http://127.0.0.1:8000/accounts/logout/`
- **测试步骤**:
  1. 登录后，点击右上角用户名菜单
  2. 选择"退出登录"
- **预期结果**:
  - 登出成功，跳转到登录页面
  - 显示再见消息

#### 1.4 密码重置
- **URL**: `http://127.0.0.1:8000/accounts/password-reset/`
- **测试步骤**:
  1. 在登录页面点击"忘记密码"
  2. 输入注册邮箱
  3. 提交重置请求
- **预期结果**:
  - 显示提示消息（演示功能）

### 功能模块2：个人中心（3个功能）

#### 2.1 查看个人中心
- **URL**: `http://127.0.0.1:8000/accounts/profile/`
- **测试步骤**:
  1. 登录后访问个人中心
  2. 查看个人信息、统计信息、我的订单
- **预期结果**:
  - 显示用户信息
  - 显示订单统计
  - 显示最近的订单列表

#### 2.2 编辑个人资料
- **URL**: `http://127.0.0.1:8000/accounts/profile/edit/`
- **测试步骤**:
  1. 访问编辑资料页面
  2. 修改姓名、邮箱、手机号
  3. 可选择上传头像
  4. 保存修改
- **预期结果**:
  - 资料更新成功
  - 显示更新后的信息

#### 2.3 修改密码
- **URL**: `http://127.0.0.1:8000/accounts/password-change/`
- **测试步骤**:
  1. 访问修改密码页面
  2. 输入旧密码
  3. 输入新密码
  4. 确认新密码
  5. 保存修改
- **预期结果**:
  - 密码修改成功
  - 需要重新登录

### 功能模块3：车辆浏览（6个功能）

#### 3.1 浏览车辆列表
- **URL**: `http://127.0.0.1:8000/accounts/home/`
- **测试步骤**:
  1. 访问首页（未登录也可访问）
  2. 查看可用车辆列表
  3. 使用搜索功能（车牌、品牌、型号）
  4. 使用筛选功能（品牌、类型、价格范围）
  5. 翻页查看
- **预期结果**:
  - 显示所有可用车辆
  - 搜索和筛选正常工作
  - 分页正常

#### 3.2 查看车辆详情
- **URL**: `http://127.0.0.1:8000/accounts/vehicle/<车辆ID>/`
- **测试步骤**:
  1. 在车辆列表中点击"查看详情"
  2. 查看车辆详细信息
  3. 查看评价统计和最近评价
  4. 如果已登录，可点击"立即租车"或"收藏"
- **预期结果**:
  - 显示完整的车辆信息
  - 显示评价统计
  - 显示收藏按钮

#### 3.3 收藏/取消收藏车辆
- **URL**: `http://127.0.0.1:8000/accounts/vehicle/<车辆ID>/favorite/`
- **测试步骤**:
  1. 登录后访问车辆详情页
  2. 点击收藏按钮
  3. 再次点击取消收藏
- **预期结果**:
  - 收藏成功，显示提示消息
  - 取消收藏成功

#### 3.4 查看我的收藏
- **URL**: `http://127.0.0.1:8000/accounts/favorites/`
- **测试步骤**:
  1. 登录后访问收藏页面
  2. 查看收藏的车辆列表
- **预期结果**:
  - 显示所有收藏的车辆

#### 3.5 车辆对比
- **URL**: `http://127.0.0.1:8000/accounts/vehicle-compare/`
- **测试步骤**:
  1. 登录后访问对比页面
  2. 选择2-3辆车进行对比
  3. 查看对比结果
- **预期结果**:
  - 显示对比表格
  - 比较车辆的各项参数

#### 3.6 查看对比结果
- **URL**: `http://127.0.0.1:8000/accounts/vehicle-compare/result/`
- **测试步骤**:
  1. 选择车辆对比后自动跳转
  2. 查看详细对比信息
- **预期结果**:
  - 显示详细的对比信息

### 功能模块4：订单管理（5个功能）

#### 4.1 查看我的订单
- **URL**: `http://127.0.0.1:8000/accounts/orders/`
- **测试步骤**:
  1. 登录后访问订单列表
  2. 使用状态筛选
  3. 使用搜索功能
  4. 翻页查看
- **预期结果**:
  - 显示所有订单
  - 筛选和搜索正常
  - 显示订单状态

#### 4.2 查看订单详情
- **URL**: `http://127.0.0.1:8000/accounts/order/<订单ID>/`
- **测试步骤**:
  1. 在订单列表中点击"查看"
  2. 查看订单详细信息
  3. 查看费用明细
  4. 查看支付记录
  5. 查看评价（如果有）
- **预期结果**:
  - 显示完整的订单信息
  - 显示支付记录
  - 显示评价按钮（如果已完成且未评价）

#### 4.3 创建订单
- **URL**: `http://127.0.0.1:8000/accounts/order/create/?vehicle=<车辆ID>`
- **测试步骤**:
  1. 确保已有客户信息（如果没有会提示）
  2. 在车辆详情页点击"立即租车"
  3. 选择租赁日期
  4. 填写备注
  5. 提交订单
- **预期结果**:
  - 订单创建成功
  - 自动计算费用
  - 更新车辆状态
  - 创建通知

#### 4.4 取消订单
- **URL**: `http://127.0.0.1:8000/accounts/order/<订单ID>/cancel/`
- **测试步骤**:
  1. 在订单详情页点击"取消订单"
  2. 输入取消原因
  3. 确认取消
- **预期结果**:
  - 订单状态变为"已取消"
  - 车辆状态恢复为"可用"
  - 创建取消通知

#### 4.5 订单评价
- **URL**: `http://127.0.0.1:8000/accounts/order/<订单ID>/review/`
- **测试步骤**:
  1. 订单完成后，在订单详情页点击"评价"
  2. 选择评分（1-5星）
  3. 填写评价内容
  4. 提交评价
- **预期结果**:
  - 评价提交成功
  - 显示在车辆详情页
  - 更新车辆评价统计

### 功能模块5：支付功能（2个功能）

#### 5.1 支付订单
- **URL**: `http://127.0.0.1:8000/accounts/payment/<订单ID>/`
- **测试步骤**:
  1. 在订单详情页点击"立即支付"
  2. 选择支付方式（支付宝、微信、银行卡、现金）
  3. 确认支付
- **预期结果**:
  - 支付成功（模拟）
  - 创建支付记录
  - 更新订单状态
  - 创建支付成功通知

#### 5.2 查看支付记录
- **URL**: `http://127.0.0.1:8000/accounts/payment/history/`
- **测试步骤**:
  1. 登录后访问支付记录页面
  2. 查看所有支付记录
  3. 使用状态筛选
  4. 翻页查看
- **预期结果**:
  - 显示所有支付记录
  - 显示支付详情

### 功能模块6：消息通知（2个功能）

#### 6.1 查看通知
- **URL**: `http://127.0.0.1:8000/accounts/notifications/`
- **测试步骤**:
  1. 登录后访问通知页面
  2. 查看所有通知
  3. 使用已读/未读筛选
  4. 点击通知查看详情
- **预期结果**:
  - 显示所有通知
  - 显示未读数量
  - 显示通知类型和内容

#### 6.2 标记已读
- **URL**: `http://127.0.0.1:8000/accounts/notification/<通知ID>/read/`
- **测试步骤**:
  1. 在通知列表中点击通知
  2. 或点击"标记为已读"
  3. 或点击"全部标记为已读"
- **预期结果**:
  - 通知标记为已读
  - 未读数量减少

### 功能模块7：帮助中心（2个功能）

#### 7.1 帮助中心
- **URL**: `http://127.0.0.1:8000/accounts/help/`
- **测试步骤**:
  1. 访问帮助中心页面
  2. 查看常见问题
  3. 查看使用指南
- **预期结果**:
  - 显示帮助内容

#### 7.2 联系客服
- **URL**: `http://127.0.0.1:8000/accounts/contact/`
- **测试步骤**:
  1. 访问联系客服页面
  2. 填写姓名、邮箱、留言
  3. 提交消息
- **预期结果**:
  - 显示提交成功消息

## 三、测试检查清单

### 基础功能
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 用户登出功能正常
- [ ] 密码重置功能正常

### 个人中心
- [ ] 查看个人中心正常
- [ ] 编辑个人资料正常
- [ ] 修改密码正常
- [ ] 统计信息显示正确

### 车辆浏览
- [ ] 车辆列表显示正常
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 分页功能正常
- [ ] 车辆详情显示完整
- [ ] 收藏功能正常
- [ ] 车辆对比功能正常

### 订单管理
- [ ] 订单列表显示正常
- [ ] 创建订单流程完整
- [ ] 订单详情显示完整
- [ ] 取消订单功能正常
- [ ] 订单评价功能正常
- [ ] 订单状态更新正确

### 支付功能
- [ ] 支付流程完整
- [ ] 支付记录显示正常
- [ ] 支付状态更新正确

### 消息通知
- [ ] 通知列表显示正常
- [ ] 标记已读功能正常
- [ ] 通知创建正确

### 帮助中心
- [ ] 帮助内容显示正常
- [ ] 联系客服功能正常

## 四、常见问题

### Q1: 运行迁移时提示需要 Pillow
**A**: 运行 `pip install Pillow` 安装 Pillow 库

### Q2: 访问页面提示模板不存在
**A**: 某些模板文件可能还未创建，请联系开发者创建缺失的模板

### Q3: 无法创建订单，提示需要客户信息
**A**: 需要先在客户管理页面添加客户信息，或者联系管理员添加

### Q4: 收藏功能不工作
**A**: 确保已登录，并且已运行数据库迁移

### Q5: 支付功能只是模拟
**A**: 是的，当前支付功能是模拟实现，实际需要接入第三方支付接口

## 五、测试建议

1. **按模块测试**: 按照功能模块顺序逐一测试
2. **记录问题**: 发现问题时记录错误信息和复现步骤
3. **测试边界**: 测试边界情况，如空数据、无效输入等
4. **测试流程**: 测试完整业务流程，如"浏览→收藏→下单→支付→评价"
5. **测试权限**: 测试不同用户角色的权限控制

## 六、测试完成后

如果测试中发现：
- 功能缺失或错误
- 模板文件缺失
- 数据库字段问题
- 业务逻辑错误

请将问题反馈给开发者进行修复。


